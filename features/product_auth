Feature: Product Authentication and Authorization

### SHOW ###
    
  Scenario Outline: User tries to view another company product
    Given I am a <role>
    And there is <owner> company
    And the company has a product
    And the product is <published>
    When I visit the product page
    Then I should see <response>
    
  Examples:
    | role      | published   | response            | owner |
    | admin     | published   | the product details | a     |
    | manager   | published   | "Access denied."    | a     |
    | operator  | published   | "Access denied."    | a     |
    | visitor   | published   | the product details | a     |
    | admin     | unpublished | the product details | a     |
    | manager   | unpublished | "Access denied."    | a     |
    | operator  | unpublished | "Access denied."    | a     |
    | visitor   | unpublished | "Access denied."    | a     |
    | admin     | published   | the product details | my    |
    | manager   | published   | the product details | my    |
    | operator  | published   | the product details | my    |
    | admin     | unpublished | the product details | my    |
    | manager   | unpublished | the product details | my    |
    | operator  | unpublished | the product details | my    |
    
    
### NEW ###
    
  Scenario Outline: New product link
    Given I am a <role>
    And there is <owner> company
    When I visit the company page
    Then I should <response>
    
  Examples:
    | role      | response                                                | owner |
    | admin     | see a "New Product" link                                | my    |
    | manager   | see a "New Product" link                                | my    |
    | operator  | see a "New Product" link                                | my    |
    | admin     | see a "New Product" link                                | a     |
    | manager   | not see a "New Product" link                            | a     |
    | operator  | not see a "New Product" link                            | a     |
    | visitor   | see "You need to sign in or sign up before continuing." | a     |

  Scenario Outline: New product page
    Given I am a <role>
    And there is <owner> company
    When I try to create a new product for the company
    Then I should see <response>
    
  Examples:
    | role      | response                                            | owner |
    | admin     | "New product"                                       | my    |
    | manager   | "New product"                                       | my    |
    | operator  | "New product"                                       | my    |
    | admin     | "New product"                                       | a     |
    | manager   | "Access denied."                                    | a     |
    | operator  | "Access denied."                                    | a     |
    | visitor   | "You need to sign in or sign up before continuing." | a     |
    
### EDIT ###

  Scenario Outline: Edit product link
    Given I am a <role>
    And there is <owner> company
    And the company has a product
    And the product is <published>
    When I visit the product page
    Then I should <response>
    
  Examples:
    | role      | response                                                  | owner | published   |
    | admin     | see a "Edit Product" link                                 | my    | published   |
    | manager   | see a "Edit Product" link                                 | my    | published   |
    | operator  | see a "Edit Product" link                                 | my    | published   |
    | admin     | see a "Edit Product" link                                 | a     | published   |
    | manager   | not see a "Edit Product" link                             | a     | published   |
    | operator  | not see a "Edit Product" link                             | a     | published   |
    | visitor   | not see a "Edit Product" link                             | a     | published   |
    | admin     | see a "Edit Product" link                                 | my    | unpublished |
    | manager   | see a "Edit Product" link                                 | my    | unpublished |
    | operator  | see a "Edit Product" link                                 | my    | unpublished |
    | admin     | see a "Edit Product" link                                 | a     | unpublished |
    | manager   | not see a "Edit Product" link                             | a     | unpublished |
    | operator  | not see a "Edit Product" link                             | a     | unpublished |
    | visitor   | see "Access denied."                                      | a     | unpublished |
  
  Scenario Outline: Edit product page
    Given I am a <role>
    And there is <owner> company
    And the company has a product
    When I try to edit the product
    Then I should see <response>
    
  Examples:
    | role      | response                                            | owner |
    | admin     | "Editing product"                                   | my    |
    | manager   | "Editing product"                                   | my    |
    | operator  | "Editing product"                                   | my    |
    | admin     | "Editing product"                                   | a     |
    | manager   | "Access denied."                                    | a     |
    | operator  | "Access denied."                                    | a     |
    | visitor   | "You need to sign in or sign up before continuing." | a     |
    
### DESTROY ###

  Scenario Outline: User tries to destroy his company's product
    Given I am a <role>
    And there is <owner> company
    And the company has a product
    And the product is <published>
    When I visit the product page
    Then I should <response>
  
  Examples:
    | role      | response                          | owner | published   |
    | admin     | see a "Destroy Product" link      | my    | published   |
    | manager   | see a "Destroy Product" link      | my    | published   |
    | operator  | see a "Destroy Product" link      | my    | published   |
    | admin     | see a "Destroy Product" link      | a     | published   |
    | manager   | not see a "Destroy Product" link  | a     | published   |
    | operator  | not see a "Destroy Product" link  | a     | published   |
    | visitor   | not see a "Destroy Product" link  | a     | published   |
    | admin     | see a "Destroy Product" link      | my    | unpublished |
    | manager   | see a "Destroy Product" link      | my    | unpublished |
    | operator  | see a "Destroy Product" link      | my    | unpublished |
    | admin     | see a "Destroy Product" link      | a     | unpublished |
    | manager   | not see a "Destroy Product" link  | a     | unpublished |
    | operator  | not see a "Destroy Product" link  | a     | unpublished |
    | visitor   | see "Access denied."              | a     | unpublished |
    
### CREATE ###
  
  Scenario Outline: Create product
    Given I am a <role>
    And there is <owner> company
    When I visit the new product page
    When I fill in the product details
    And I click on "Create Product"
    Then I should see <response>
    
  Examples:
    | role      | response                                            | owner |
    | admin     | "Product was successfully created."                 | my    |
    | manager   | "Product was successfully created."                 | my    |
    | operator  | "Product was successfully created."                 | my    |
    | admin     | "Product was successfully created."                 | a     |
    
### UPDATE ###
  
  Scenario Outline: User tries to update a company
    Given I am a <role>
    And there is <owner> company
    And the company has a product
    When I visit the product edit page
    And I fill in the product details
    And I click on "Update Product"
    Then I should see <response>
    
    Examples:
      | role      | response                            | owner |
      | admin     | "Product was successfully updated." | my    |
      | manager   | "Product was successfully updated." | my    |
      | operator  | "Product was successfully updated." | my    |
      | admin     | "Product was successfully updated." | a     |